---

ENABLED  : {{ not (empty (include "arkcase.subsystem.enabled" $)) }}
EXTERNAL : {{ not (empty (include "arkcase.subsystem.external" $)) }}
ENABLED_OR_EXTERNAL : {{ not (empty (include "arkcase.subsystem.enabledOrExternal" $)) }}
SUBSYSTEM_NAME: {{ (include "arkcase.subsystem.name" $) | quote }}
SUBSYSTEM_INFO: {{ (include "arkcase.subsystem" $ | nindent 2) }}

---
CONFIGURATION: {{- include "arkcase.subsystem-access.conf" $ | nindent 2 }}

---
BASE  =[{{ include "arkcase.subsystem-access.name" $ }}]
ADMIN =[{{ include "arkcase.subsystem-access.name" (dict "ctx" $ "conn" "admin") }}]
OTHER =[{{ include "arkcase.subsystem-access.name" (dict "ctx" $ "subsys" "othersubsys") }}]
TEST  =[{{ include "arkcase.subsystem-access.name" (dict "ctx" $ "subsys" "someother" "conn" "connection") }}]

{{- /* -}}
---
{{- $ctx := $ }}
{{- range $subsys := (list ($.Chart.Name) "subsys-one" "subsystwo" "sub3") }}
  {{- range $conn := (list "main" "admin" "extra") }}
    {{- range $key := (list "" "firstKey" "anotherValue") }}
      {{- range $name := (list "" "ONE_VAR" "OTHER_VAR" "${subsys}-CRAP-${key}-${conn}") }}
        {{- range $mountPath := (list "" "/one/mount/point" "/another/mount") }}
          {{- range $optional := (list "" "false" "true") }}
            {{-
              $p := dict
                "ctx" $ctx
                "subsys" $subsys
                "conn" $conn
                "key" $key
                "name" $name
                "mountPath" $mountPath
                "optional" $optional
            }}
---
PARAMS: {{- (omit $p "ctx") | toYaml | nindent 2 }}
RESULT: {{- include "__arkcase.subsystem-access.extract-params" $p | nindent 2 }}
          {{- end }}
        {{- end }}
      {{- end }}
    {{- end }}
  {{- end }}
{{- end }}
{{- */ -}}
---
{{- include "__arkcase.subsystem-access.deps" $ | nindent 0 }}
