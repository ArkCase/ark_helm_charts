{{- if (include "arkcase.subsystem.enabled" .) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "arkcase.subsystem.name" . | quote }}
  namespace: {{ .Release.Namespace | quote }}
  labels: {{- include "common.labels" . | nindent 4 }}
    {{- with (.Values.labels).common }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  annotations:
    timestamp: {{ date "20060102150405" now | quote }}
    {{- with (.Values.annotations).common }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
type: Opaque
stringData:
  context.xml: |
    <?xml version="1.0" encoding="UTF-8"?>
    <Context path="/pentaho" docbase="webapps/pentaho/">
      <Resource name="jdbc/Hibernate" auth="Container" type="javax.sql.DataSource"
                factory="org.pentaho.di.core.database.util.DecryptingDataSourceFactory"
                {{- include "arkcase.pentaho.datasource.params" ((.Values.configuration).db).hibernate | nindent 16 }}
                />
    
      <Resource name="jdbc/Audit" auth="Container" type="javax.sql.DataSource"
                factory="org.pentaho.di.core.database.util.DecryptingDataSourceFactory"
                {{- include "arkcase.pentaho.datasource.params" ((.Values.configuration).db).audit | nindent 16 }}
                />
    
      <Resource name="jdbc/Quartz" auth="Container" type="javax.sql.DataSource"
                factory="org.pentaho.di.core.database.util.DecryptingDataSourceFactory"
                {{- include "arkcase.pentaho.datasource.params" ((.Values.configuration).db).quartz | nindent 16 }}
                />
    
      <Resource name="jdbc/PDI_Operations_Mart" auth="Container" type="javax.sql.DataSource"
                factory="org.pentaho.di.core.database.util.DecryptingDataSourceFactory"
                {{- include "arkcase.pentaho.datasource.params" ((.Values.configuration).db).pdiOperationsMart | nindent 16 }}
                />
    
      <Resource name="jdbc/pentaho_operations_mart" auth="Container" type="javax.sql.DataSource"
                factory="org.pentaho.di.core.database.util.DecryptingDataSourceFactory"
                {{- include "arkcase.pentaho.datasource.params" ((.Values.configuration).db).pentahoOperationsMart | nindent 16 }}
                />
    
     <Resource name="jdbc/live_logging_info" auth="Container" type="javax.sql.DataSource"
                factory="org.pentaho.di.core.database.util.DecryptingDataSourceFactory"
                {{- include "arkcase.pentaho.datasource.params" ((.Values.configuration).db).liveLogging | nindent 16 }}
                />
    
      <Resource name="jdbc/SampleData" auth="Container" type="javax.sql.DataSource"
                factory="org.pentaho.di.core.database.util.DecryptingDataSourceFactory"
                {{- include "arkcase.pentaho.datasource.params" ((.Values.configuration).db).sampleData | nindent 16 }}
                />
    
      <Resource name="jdbc/SampleDataAdmin" auth="Container" type="javax.sql.DataSource"
                factory="org.pentaho.di.core.database.util.DecryptingDataSourceFactory"
                {{- include "arkcase.pentaho.datasource.params" ((.Values.configuration).db).sampleDataAdmin | nindent 16 }}
                />
    
      <Resource name="jdbc/jackrabbit" auth="Container" type="javax.sql.DataSource"
                factory="org.pentaho.di.core.database.util.DecryptingDataSourceFactory"
                {{- include "arkcase.pentaho.datasource.params" ((.Values.configuration).db).jcr | nindent 16 }}
                />
    </Context>
{{- end }}
