{{- if (include "arkcase.subsystem.enabled" .) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "common.fullname" . | quote }}
  namespace: {{ .Release.Namespace | quote }}
  labels: {{- include "common.labels" . | nindent 4 }}
    {{- with (.Values.labels).common }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  annotations:
    timestamp: {{ date "20060102150405" now | quote }}
    {{- with (.Values.annotations).common }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
type: Opaque
stringData:
{{- with (.Values.configuration).ssl }}
  {{- if or .crt .key }}
    {{- $crt := (required "Must provide a certificate in the SSL section (label = 'crt')" (.crt)) }}
    {{- $key := (required "Must provide a certificate in the SSL section (label = 'key')" (.key)) }}
  crt.pem: | {{ $crt | nindent 4 }}
  key.pem: | {{ $key | nindent 4 }}
  {{- end }}
  {{- if .ca }}
  ca.pem: | {{ .ca | nindent 4 }}
  {{- end }}
{{- end }}
{{- end }}
