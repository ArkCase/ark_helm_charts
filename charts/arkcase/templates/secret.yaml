{{- if (include "arkcase.subsystem.enabled" .) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "common.fullname" . | quote }}
  namespace: {{ .Release.Namespace | quote }}
  labels: {{- include "common.labels" . | nindent 4 }}
    {{- with (.Values.labels).common }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  annotations:
    timestamp: {{ date "20060102150405" now | quote }}
    {{- with (.Values.annotations).common }}
      {{- toYaml . | nindent 4 }}
    {{- end }}
type: Opaque
stringData:
  application.yml: |-
    server.port: 9999
    spring:
      profiles.active: native
      cloud.config.server:
        native.searchLocations: "file://${DATA_DIR},file://${DATA_DIR}/rules,file://${DATA_DIR}/lookups,file://${DATA_DIR}/ldap,file://${DATA_DIR}/labels"
      jms:
        pub-sub-domain: true
    properties.folder.path: "${DATA_DIR}"
    branding.files.folder.path: "${DATA_DIR}/branding"
    logging:
      # file.max-history: 10
      # file.max-size: 10MB
      file: /dev/stdout
      level:
        com.armedia.acm.configserver: debug
        org.springframework.cloud.config: debug
      pattern:
        file: "%d{yyyy-MM-dd HH:mm:ss,SSS} [%thread] %-5level %logger.%M - %msg%n"
    jms.message.buffer.window: 1
    acm.activemq:
      broker-url: {{ (((.Values.configuration).messaging).config).brokerUrl | default "tcp://messaging:61616" | quote }}
      user: {{ (((.Values.configuration).messaging).config).user | default "cloudconfig" | quote }}
      password: {{ (((.Values.configuration).messaging).config).password | default "c70uDk0nf19!" | quote }}
      default-destination: configuration.changed
      labels-destination: labels.changed
      ldap-destination: ldap.changed
      lookups-destination: lookups.changed
      rules-destination: rules.changed
      timeout: 10
      {{- with ((.Values.configuration).ssl).keystore }}
      {{- if .location }}
      keystore: {{ .location | quote }}
      {{- end }}
      {{- if .password }}
      keystore-password: {{ .password | quote }}
      {{- end }}
      {{- end }}
      {{- with ((.Values.configuration).ssl).truststore }}
      {{- if .location }}
      truststore: {{ .location | quote }}
      {{- end }}
      {{- if .password }}
      truststore-password: {{ .password | quote }}
      {{- end }}
      {{- end }}
    arkcase.languages: "-de,-en,-en-in,-es,-fr,-hi,-ja,-pt,-ru,-zh-cn,-zh-tw"

  arkcase-server.yaml: |-

    ################################################################################
    #                                                                              #
    # Application settings                                                         #
    #                                                                              #
    ################################################################################
    {{- ((.Values.configuration).arkcase).settings | default dict | toYaml | nindent 4 }}

    # Calendar Configured Object Types (calendarConfiguredObjectTypes.properties)
    calendar: {{- ((.Values.configuration).arkcase).calendar | default dict | toYaml | nindent 6 }}

    # AWS Credentials (aws/credentials.properties)
    ## AccessKeyId and SecretAccessKey must be encrypted.
    aws.credentials: {{- (.Values.configuration).aws | default dict | toYaml | nindent 6 }}

    application.rolesToGroups: {{- ((.Values.configuration).arkcase).rolesToGroups | default dict | toYaml | nindent 6 }}

    # ArkCase configurations
    application: {{- ((.Values.configuration).arkcase).application | default dict | toYaml | nindent 6 }}

    # OCR Library
    ocr: {{- (.Values.configuration).ocr | default dict | toYaml | nindent 6 }}

    # Hazelcast/Cluster coordinator
    # acm.hazelcast:
    #   log.folder: "/tmp"

    ################################################################################
    #                                                                              #
    # Subsystem and external server access settings                                #
    #                                                                              #
    ################################################################################

    # DB Connection
    acm: {{- (.Values.configuration).db | default dict | toYaml | nindent 6 }}

    # Elk/search (?)
    # elk:
    #   server:
    #     url: "https://elk/arkcase/acm-elastic"

    # Frevvo/forms editing
    # frevvo:
    #   admin.password: "admin"
    #   service.external.baseUrl: "http://forms"
    #   browser.redirect.baseUrl: "http://forms"
    #   host: "what-goes-here-?"

    # Pentaho/reporting tool
    report: {{- (.Values.configuration).reports | default dict | toYaml | nindent 6 }}

    # Solr/search
    solr: {{- (.Values.configuration).search | default dict | toYaml | nindent 6 }}

    # Snowbound/document viewer+editor
    ecm: {{- (.Values.configuration).viewer | default dict | toYaml | nindent 6 }}

    # E-mail integration
    outlook.exchange.integration: {{- (.Values.configuration).outlook | default dict | toYaml | nindent 6 }}

    # Notification Plugin Configuration (notification.properties)
    notification: {{- (.Values.configuration).notification | default dict | toYaml | nindent 6 }}

    # Office 365 plugin (?)
    wopi.plugin: {{- (.Values.configuration).office365 | default dict | toYaml | nindent 6 }}

    # Alfresco/CMIS content store
    alfresco: {{- (.Values.configuration).content | default dict | toYaml | nindent 6 }}

    # Alfresco RMA Plugin Configuration (alfrescoRmaPlugin.properties)
    {{- (.Values.configuration).records | default dict | toYaml | nindent 4 }}

    # E-mail server (SMTP)
    email: {{- (.Values.configuration).email | default dict | toYaml | nindent 6 }}

    # ActiveMQ/Messaging
    ark.activemq: {{- ((.Values.configuration).messaging).broker | default dict | toYaml | nindent 6 }}
      #URL of the ActiveMQ broker.

    # ActiveMQ/Messaging
    ark.websockets: {{- ((.Values.configuration).messaging).stomp | default dict | toYaml | nindent 6 }}

    # Touchnet payment processor integration
    payment: {{- (.Values.configuration).payment | default dict | toYaml | nindent 6 }}

    # Zylab/legal discovery platform
    zylabIntegration: {{- (.Values.configuration).legal | default dict | toYaml | nindent 6 }}
{{- end }}
