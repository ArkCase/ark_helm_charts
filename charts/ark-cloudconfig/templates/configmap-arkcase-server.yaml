{{- if (include "arkcase.subsystem.enabled" .) }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ printf "%s-server-config" (include "common.fullname" .) | quote }}
  namespace: {{ .Release.Namespace | quote }}
  labels: {{- include "common.labels" . | nindent 4 }}
    {{- with (.Values.labels).common }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  annotations:
    timestamp: {{ date "20060102150405" now | quote }}
    {{- with (.Values.annotations).common }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
data:
  arkcase-server.yaml: |-

    ################################################################################
    #                                                                              #
    # Application settings                                                         #
    #                                                                              #
    ################################################################################
    {{- ((.Values.configuration).arkcase).settings | default dict | toYaml | nindent 4 }}

    # Calendar Configured Object Types (calendarConfiguredObjectTypes.properties)
    calendar: {{- ((.Values.configuration).arkcase).calendar | default dict | toYaml | nindent 6 }}

    # AWS Credentials (aws/credentials.properties)
    ## AccessKeyId and SecretAccessKey must be encrypted.
    aws.credentials: {{- (.Values.configuration).aws | default dict | toYaml | nindent 6 }}

    application.rolesToGroups: {{- ((.Values.configuration).arkcase).rolesToGroups | default dict | toYaml | nindent 6 }}

    # ArkCase configurations
    application: {{- ((.Values.configuration).arkcase).application | default dict | toYaml | nindent 6 }}

    # OCR Library
    ocr: {{- (.Values.configuration).ocr | default dict | toYaml | nindent 6 }}

    # Hazelcast/Cluster coordinator
    # acm.hazelcast:
    #   log.folder: "/tmp"

    ################################################################################
    #                                                                              #
    # Subsystem and external server access settings                                #
    #                                                                              #
    ################################################################################

    # DB Connection
    acm: {{- (.Values.configuration).db | default dict | toYaml | nindent 6 }}

    # Elk/search (?)
    # elk:
    #   server:
    #     url: "https://elk/arkcase/acm-elastic"

    # Frevvo/forms editing
    # frevvo:
    #   admin.password: "admin"
    #   service.external.baseUrl: "http://forms"
    #   browser.redirect.baseUrl: "http://forms"
    #   host: "what-goes-here-?"

    # Pentaho/reporting tool
    report: {{- (.Values.configuration).reports | default dict | toYaml | nindent 6 }}

    # Solr/search
    solr: {{- (.Values.configuration).search | default dict | toYaml | nindent 6 }}

    # Snowbound/document viewer+editor
    ecm: {{- (.Values.configuration).viewer | default dict | toYaml | nindent 6 }}

    # E-mail integration
    outlook.exchange.integration: {{- (.Values.configuration).outlook | default dict | toYaml | nindent 6 }}

    # Notification Plugin Configuration (notification.properties)
    notification: {{- (.Values.configuration).notification | default dict | toYaml | nindent 6 }}

    # Office 365 plugin (?)
    wopi.plugin: {{- (.Values.configuration).office365 | default dict | toYaml | nindent 6 }}

    # Alfresco/CMIS content store
    alfresco: {{- (.Values.configuration).content | default dict | toYaml | nindent 6 }}

    # Alfresco RMA Plugin Configuration (alfrescoRmaPlugin.properties)
    {{- (.Values.configuration).records | default dict | toYaml | nindent 4 }}

    # E-mail server (SMTP)
    email: {{- (.Values.configuration).email | default dict | toYaml | nindent 6 }}

    # ActiveMQ/Messaging
    ark.activemq: {{- ((.Values.configuration).messaging).broker | default dict | toYaml | nindent 6 }}
      #URL of the ActiveMQ broker.

    # ActiveMQ/Messaging
    ark.websockets: {{- ((.Values.configuration).messaging).stomp | default dict | toYaml | nindent 6 }}

    # Touchnet payment processor integration
    payment: {{- (.Values.configuration).payment | default dict | toYaml | nindent 6 }}

    # Zylab/legal discovery platform
    zylabIntegration: {{- (.Values.configuration).legal | default dict | toYaml | nindent 6 }}
{{- end }}
