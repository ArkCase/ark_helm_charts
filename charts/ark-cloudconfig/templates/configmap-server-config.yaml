{{- if (include "arkcase.subsystem.enabled" .) }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ printf "%s-server-config" (include "common.fullname" .) | quote }}
  namespace: {{ .Release.Namespace | quote }}
  labels: {{- include "common.labels" . | nindent 4 }}
    {{- with .Values.labels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  annotations:
    timestamp: {{ date "20060102150405" now | quote }}
    {{- with .Values.annotations }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
data:
  arkcase-server.yaml: |-
    {{- if .Values.global.db.externalHost.enabled }}
    acm:
      driverClassName: "{{ .Values.global.db.externalHost.driverName }}"
      url: "jdbc:mysql://{{ .Values.global.db.externalHost.hostAddress }}:3306?autoReconnect=true&useUnicode=true&characterEncoding=UTF-8"
      password: {{ .Values.global.db.externalHost.password | quote}}
    {{- else }}
    acm:
      driverClassName: "org.mariadb.jdbc.Driver"
      url: "jdbc:mysql://ark-core-mariadb:3306/arkcase"
      password: "arkcase@123"
    {{- end }}
    elk:
      server:
        url: "https://{{ external_host }}/arkcase/acm-elastic"
    frevvo:
      admin.password: "admin"
      service.external.baseUrl: "https://{{ .Values.global.domainName }}"
      browser.redirect.baseUrl: "https://{{ .Values.global.domainName }}"
      host: "{{ .Values.global.domainName }}"
    report:
      plugin:
        PENTAHO_SERVER_URL: "https://{{ .Values.global.domainName}}"
        PENTAHO_SERVER_USER: "arkcase-admin"
        PENTAHO_SERVER_PASSWORD: "Ai-0c9d92f7ef9b1d6a1"
        PENTAHO_SERVER_INTERNAL_URL: "http://pentaho"
        PENTAHO_SERVER_INTERNAL_PORT: 2002
    solr:
      host: {{ .Values.global.domainName}}
      port: 443
    fileEditingEnabled: false
    ecm:
      viewer.snowbound.encryptionKey: ""
      viewer.snowbound.readonly:
        url: "https://{{ .Values.global.domainName }}/VirtualViewerJavaHTML5/index-read-only.html?documentId=ecmFileId=$[fileId]%26acm_ticket=$[ticket]%26userid=$[userid]"
    outlook.exchange.integration:
      enabled: false
      system_user_email: "dev.core@arkcase.com"
      system_user_email_password: ""
      system_user_id: "dev.core@arkcase.com"
    ################### Notification Plugin Configuration (notification.properties) ####################  
    notification:
      arkcase.url: "https://{{ .Values.global.domainName}}"
      arkcase.url.base: "https://{{ .Values.global.domainName }}"
      onlyoffice.plugin:
      #base url used for sending to onlyoffice to be able to perform callbacks
      arkcase.baseurl: "https://{{ .Values.global.domainName }}"
    wopi.plugin:
      tenant:
        domain: "{{ .Values.global.domainName}}"
        port: 443
    application:
      properties:
        idleLimit: 600000
        idlePull: 5000
        idleConfirm: 15000
        displayUserName: "userName"
        historyDays: 30
        baseUrl: "https://{{ .Values.global.domainName }}"
        applicationName: "arkcase"
        alfrescoUserIdLdapAttribute: "samAccountName"
        issueCollectorFlag: false
        logoutUrl: "/logout"
    alfresco:
      admin:
        baseurl: "https://{{ .Values.global.domainName }}/alfresco/s/admin/admin-sync"
        username: "admin"
        password: "admin"
      sync:
        host: "{{ .Values.global.domainName }}"
        port: 443
        enabled: true
        username: "admin"
        password: "admin"
    ################### Alfresco RMA Plugin Configuration (alfrescoRmaPlugin.properties) ####################
    alfresco_host: "{{ .Values.global.domainName  }}"
    alfresco_port: 443
    email:
      should-delete-messages: false
      should-mark-messages-as-read: true
      sender:
        type: "smtp"
        encryption: "starttls"
        allowAttachments: true
        allowDocuments: true
        host: "smtp.office365.com"
        allowHyperlinks: true
        userFrom: "dev.core@arkcase.com"
        port: 587
        username: "dev.core@arkcase.com"
        password: "Gar800818"
        convertDocumentsToPdf: false
    ################### Outlook email address for email ingestion - Mail Receiver ###################
    #set some existing email here for testing
    CASE_FILE.user: ""
    CASE_FILE.password: ""
    COMPLAINT.user: ""
    COMPLAINT.password: ""
    CONSULTATION.user: ""
    CONSULTATION.password: ""
    host: "outlook.office365.com"
    port: 993 
    create:
      case.enabled: false
      complaint.enabled: false
    ocr:
      tempPath: "${HOME}/tmp/arkcase/"
    ark.activemq:
      #URL of the ActiveMQ broker.
      transportConnectorURI: "ssl://{{ .Values.global.domainName }}:61616"
    acm.websockets:
      stomp_broker_relay.relay_protocol: ssl
      stomp_broker_relay.relay_host: "{{ .Values.global.activemq.brokerUrl }}"
      # stomp_broker_relay.client_login: "{{ .Values.global.activemq.username }}"
      # stomp_broker_relay.client_passcode: "{{ .Values.global.activemq.password}}"
      #STOMP (ArkCase to ActiveMQ) authentication
      stomp_broker_relay.system_login: "{{ .Values.global.activemq.username}}"
      stomp_broker_relay.system_passcode: "{{ .Values.global.activemq.password}}"
    ################### Calendar Configured Object Types (calendarConfiguredObjectTypes.properties) ####################
    calendar:
      configuration: "{\"CASE_FILE\":{\"integrationEnabled\":true,\"systemEmail\"\
        :\"dev.core@arkcase.com\",\"password\":\"admin\"\
        ,\"purgeOptions\":\"RETAIN_INDEFINITELY\",\"daysClosed\":null},\"COMPLAINT\":{\"\
        integrationEnabled\":false,\"systemEmail\":\"dev.core@arkcase.com\",\"password\":\"admin\",\"purgeOptions\"\
        :\"RETAIN_INDEFINITELY\",\"daysClosed\":null}}"
    acm.hazelcast:
      log.folder: "/tmp"

    ################### AWS Credentials (aws/credentials.properties) ####################
    ## AccessKeyId and SecretAccessKey must be encrypted. ##
    aws.credentials:
      awsAccessKeyId: ""
      awsSecretAccessKey: ""
    payment:
      touchnet:
        username: ""
        password: ""
        securelinkendpoint: ""
        upaysiteid: ""
    application.rolesToGroups:
    ROLE_ADMINISTRATOR:
    - 247.ARKCASE_ADMINISTRATOR@APPDEV.ARMEDIA.COM
    - 247.ARKCASE_ENTITY_ADMINISTRATOR@APPDEV.ARMEDIA.COM
    ROLE_BILLING_QUEUE:
    - 247.ARKCASE_ADMINISTRATOR@APPDEV.ARMEDIA.COM
    - 247.ARKCASE_SUPERVISOR@APPDEV.ARMEDIA.COM
    - 247.ARKCASE_CONTRIBUTOR@APPDEV.ARMEDIA.COM
    - 247.ARKCASE_CONSUMER@APPDEV.ARMEDIA.COM
    - 247.ARKCASE_EXTERNAL@APPDEV.ARMEDIA.COM
    ROLE_CONSUMER:
    - 247.ARKCASE_CONSUMER@APPDEV.ARMEDIA.COM
    ROLE_ENTITY_ADMINISTRATOR:
    - 247.ARKCASE_ENTITY_ADMINISTRATOR@APPDEV.ARMEDIA.COM
    ROLE_EXTERNAL:
    - 247.ARKCASE_EXTERNAL@APPDEV.ARMEDIA.COM
    ROLE_SUPERVISOR:
    - 247.ARKCASE_SUPERVISOR@APPDEV.ARMEDIA.COM
    - 247.ARKCASE_ADMINISTRATOR@APPDEV.ARMEDIA.COM
{{- end }}
