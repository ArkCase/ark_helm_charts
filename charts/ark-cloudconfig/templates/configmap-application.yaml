{{- if (include "arkcase.subsystem.enabled" .) }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "common.fullname" . | quote }}
  namespace: {{ .Release.Namespace | quote }}
  labels: {{- include "common.labels" . | nindent 4 }}
    {{- with (.Values.labels).common }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  annotations:
    timestamp: {{ date "20060102150405" now | quote }}
    {{- with (.Values.annotations).common }}
      {{- toYaml . | nindent 4 }}
    {{- end }}
data:
  application.yml: |-
    server.port: 9999
    spring:
      profiles.active: native
      cloud.config.server:
        native.searchLocations: "file://${DATA_DIR},file://${DATA_DIR}/rules,file://${DATA_DIR}/lookups,file://${DATA_DIR}/ldap,file://${DATA_DIR}/labels"
      jms:
        pub-sub-domain: true
    properties.folder.path: "${DATA_DIR}"
    branding.files.folder.path: "${DATA_DIR}/branding"
    logging:
      # file.max-history: 10
      # file.max-size: 10MB
      file: /dev/stdout
      level:
        com.armedia.acm.configserver: debug
        org.springframework.cloud.config: debug
      pattern:
        file: "%d{yyyy-MM-dd HH:mm:ss,SSS} [%thread] %-5level %logger.%M - %msg%n"
    jms.message.buffer.window: 1
    acm.activemq:
      broker-url: {{ (((.Values.configuration).messaging).config).brokerUrl | default "tcp://messaging:61616" | quote }}
      user: {{ (((.Values.configuration).messaging).config).user | default "cloudconfig" | quote }}
      password: {{ (((.Values.configuration).messaging).config).password | default "c70uDk0nf19!" | quote }}
      default-destination: configuration.changed
      labels-destination: labels.changed
      ldap-destination: ldap.changed
      lookups-destination: lookups.changed
      rules-destination: rules.changed
      timeout: 10
      {{- with ((.Values.configuration).ssl).keystore }}
      {{- if .location }}
      keystore: {{ .location | quote }}
      {{- end }}
      {{- if .password }}
      keystore-password: {{ .password | quote }}
      {{- end }}
      {{- end }}
      {{- with ((.Values.configuration).ssl).truststore }}
      {{- if .location }}
      truststore: {{ .location | quote }}
      {{- end }}
      {{- if .password }}
      truststore-password: {{ .password | quote }}
      {{- end }}
      {{- end }}
    arkcase.languages: "-de,-en,-en-in,-es,-fr,-hi,-ja,-pt,-ru,-zh-cn,-zh-tw"
{{- end }}
