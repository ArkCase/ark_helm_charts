{{- $foia := (include "arkcase.foia" $ | fromYaml) -}}
{{- if $foia -}}
  {{- $params := (dict "ctx" $ "server" $foia.ldap.server) -}}
ldapConfig.id=foiaportal
ldapConfig.ldapUrl={{ include "arkcase.ldap" (merge (dict "value" "url") $params) }}
ldapConfig.base={{ include "arkcase.ldap.baseDn" $params }}
ldapConfig.authUserDn={{ include "arkcase.ldap.bindDn" $params }}
ldapConfig.authUserPassword={{ include "arkcase.ldap" (merge (dict "value" "bind.password") $params) }}

ldapConfig.userDomain={{ include "arkcase.ldap" (merge (dict "value" "domain") $params) }}
ldapConfig.userSearchBase={{ include "arkcase.ldap" (merge (dict "value" "search.users.base") $params) }}
ldapConfig.userPrefix={{ include "arkcase.ldap" (merge (dict "value" "search.users.prefix") $params) }}
ldapConfig.groupSearchBase={{ include "arkcase.ldap" (merge (dict "value" "search.groups.base") $params) }}
ldapConfig.groupPrefix={{ include "arkcase.ldap" (merge (dict "value" "search.groups.prefix") $params) }}

# whether to auto-generate the user id; true for 
# external portal, false for ArkCase
ldapConfig.autoGenerateUserId={{ $foia.generateUsers }}

ldapConfig.userAttributes=cn,userAccountControl,sn,givenName,dn,distinguishedname,memberOf,sAMAccountName,userPrincipalName,uid,uidNumber,c,co,company,department,title,msDS-UserPasswordExpiryTimeComputed,modifyTimestamp,description,member

ldapConfig.syncPageSize=500
ldapConfig.syncEnabled=true

ldapConfig.enableEditingLdapUsers=true
ldapConfig.directoryType=activedirectory

ldapConfig.userSearchFilter=(&(objectClass=user)(sAMAccountName=%s))
ldapConfig.allUsersFilter=(&(objectCategory=person)(objectClass=user)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))
ldapConfig.allChangedUsersFilter=(&(objectCategory=person)(objectClass=user)(!(userAccountControl:1.2.840.113556.1.4.803:=2))(modifyTimestamp>=%s))
ldapConfig.allUsersPageFilter=(&(objectCategory=person)(objectClass=user)(!(userAccountControl:1.2.840.113556.1.4.803:=2))(sAMAccountName>=%s))
ldapConfig.allChangedUsersPageFilter=(&(objectCategory=person)(objectClass=user)(!(userAccountControl:1.2.840.113556.1.4.803:=2))(sAMAccountName>=%s)(modifyTimestamp>=%s))
ldapConfig.allUsersSortingAttribute=sAMAccountName
ldapConfig.groupSearchFilterForUser=(&(objectClass=group)(member=%s))
ldapConfig.userIdAttributeName=sAMAccountName
ldapConfig.groupSearchFilter=(objectclass=group)
ldapConfig.changedGroupSearchFilter=(&(objectclass=group)(modifyTimestamp>=%s))
ldapConfig.groupSearchPageFilter=(&(objectclass=group)(cn>=%s))
ldapConfig.changedGroupSearchPageFilter=(&(objectclass=group)(cn>=%s)(modifyTimestamp>=%s))
ldapConfig.groupsSortingAttribute=cn
ldapConfig.userControlGroup=
ldapConfig.groupControlGroup=
ldapConfig.partialSyncCron=0 0/30 * 1/1 * ? *
ldapConfig.fullSyncCron=0 5 0 1/1 * ? *
{{- end -}}
