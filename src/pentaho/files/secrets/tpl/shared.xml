{{- /* This file should be mounted as /app/pentaho/.kettle/shared.xml */ -}}
{{- $foia := (include "arkcase.foia" $ | fromYaml) -}}
{{- $analytics := (include "arkcase.analytics" $ | fromYaml) -}}
<?xml version="1.0" encoding="UTF-8"?>
<sharedobjects>
  {{- if $foia }}
  <connection>
    <name>ArkCase</name>
    {{- with (include "arkcase.db.schema" (dict "ctx" $ "schema" "arkcase") | fromYaml) }}
    <server>{{ .hostname }}</server>
    <port>{{ .port }}</port>
    <database>{{ include "arkcase.xmlEscape" .database }}</database>
    <username>{{ include "arkcase.xmlEscape" .username }}</username>
    <password>{{ include "arkcase.xmlEscape" .password }}</password>
    <type>GENERIC</type>
    <access>Native</access>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>CUSTOM_DRIVER_CLASS</code>
        <attribute>{{ .jdbc.driver }}</attribute>
      </attribute>
      <attribute>
        <code>CUSTOM_URL</code>
        <attribute>{{ include "arkcase.xmlEscape" .jdbc.url }}</attribute>
      </attribute>
    </attributes>
    {{- end }}
  </connection>
  {{- end }}
  {{- with $analytics }}
  <connection>
    <name>Neo4j Local</name>
    <server>{{ .hostname }}</server>
    <port>{{ .port }}</port>
    <database>{{ include "arkcase.xmlEscape" .database }}</database>
    <username>{{ include "arkcase.xmlEscape" .username }}</username>
    <password>{{ include "arkcase.xmlEscape" .password }}</password>
    <type>GENERIC</type>
    <access>Native</access>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>CUSTOM_DRIVER_CLASS</code>
        <attribute>{{ .jdbc.driver }}</attribute>
      </attribute>
      <attribute>
        <code>CUSTOM_URL</code>
        <attribute>{{ include "arkcase.xmlEscape" .jdbc.url }}</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  {{- end }}
</sharedobjects>
