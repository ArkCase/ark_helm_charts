{{- $samlconfig := (include "arkcase.saml" $) -}}
{{- if $samlconfig -}}
  {{- $conf := get (fromYaml $samlconfig) "saml" -}}
  {{- if $conf -}}
# NOTE: we should further externalize all SAML-related Spring configuration properties
# used in $HOME/.arkcase/acm/spring-security/spring-security-config-saml.xml

# SECTION 1: configuration parameters for metadata generator

# globally unique name for a SAML entity
saml.metadataGenerator.entityId={{ $conf.entityId }}
# base URL used in generated metadata to form service endpoints, such as single-logout or assertion-consumer service
# it should be the URL as IdP sees it (usually a reverse-proxy address)
saml.metadataGenerator.entityBaseURL=https://{{ $conf.arkcaseHost }}{{ $conf.arkcaseContextPath }}
# federation metadata url (issuer's certificate must be added to ${user.home}/.arkcase/acm/sso/keystore.jks as trusted CA certificate)
saml.federationMetadata.url={{ $conf.identityProviderUrl }}
# federation metadata backup file location
saml.federationMetadata.backupFile=${user.home}/.arkcase/acm/sso/idp.xml

saml.keystore.password=${k8s.keystore.pass}
saml.keystore.file=${k8s.keystore.file}

# SECTION 2: configuration parameters for load balancer context provider

# incoming endpoint protocol (as IdP sees it on reverse proxy)
saml.contextProvider.scheme=https
# incoming endpoint server name (as IdP sees it on reverse proxy)
saml.contextProvider.serverName={{ $conf.arkcaseHost }}
# incoming endpoint context path (as IdP sees it on reverse proxy)
# must start with a forward slash!
saml.contextProvider.contextPath={{ $conf.arkcaseContextPath }}

# configure same as 'ldapConfig.userDomain' and 'ldapConfig.userPrefix' properties only when Azure SAML provider is used
saml.userDomain=
saml.userPrefix=

  {{- else }}
# SAML is not active
  {{- end }}
{{- end }}
