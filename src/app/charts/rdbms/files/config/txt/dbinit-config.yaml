#
# Details regarding the administrative password
#
admin:
  # Make sure this is set every time
  # force: true
  username: "@env:DB_ADMIN_USERNAME"
  password: "@env:DB_ADMIN_PASSWORD"

#
# Applies to both users and databases - maps the old name
# to the new one, in order to render user renaming queries
#
# TODO: Before we can unleash the new names, we must add the code to
#       do the renames/recreates for users and databases
# renames:
#   jcr: pentaho-jcr
#   quartz: pentaho-quartz
#   content: alfresco

#
# Map a database name to the username who will
# be granted full permissions on the database
#
# TODO: For now we use the old names. The new names are commented out.
databases:
  arkcase: arkcase
  content: content
  # alfresco: alfresco
  pentaho: pentaho
  # pentaho-jcr: pentaho-jcr
  jcr: jcr
  # pentaho-quartz: pentaho-quartz
  quartz: quartz

#
# Map the username to the password specification
#
# TODO: For now we use the old names. The new names are commented out
users:
  arkcase:
    username: "@env:DB_ARKCASE_USERNAME"
    password: "@env:DB_ARKCASE_PASSWORD"
  # alfresco:
  content:
    username: "@env:DB_ALFRESCO_USERNAME"
    password: "@env:DB_ALFRESCO_PASSWORD"
  pentaho:
    username: "@env:DB_PENTAHO_USERNAME"
    password: "@env:DB_PENTAHO_PASSWORD"
  # pentaho-jcr:
  jcr:
    username: "@env:DB_PENTAHO_JCR_USERNAME"
    password: "@env:DB_PENTAHO_JCR_PASSWORD"
  # pentaho-quartz:
  quartz:
    username: "@env:DB_PENTAHO_QUARTZ_USERNAME"
    password: "@env:DB_PENTAHO_QUARTZ_PASSWORD"

scripts:
  boot:
    # This is important to fix the LDAP directory names on first boot
    #
    # TODO: This should be done by ArkCase as part of ADS-2378. When
    #       that's done, this script can be removed
    #
    # We don't set a user b/c we're OK with running this as the admin
    - db: "arkcase"
      query: |
        --
        -- FIX DIRECTORY NAMES FOR USERS
        --

        -- Accelerate the update
        CREATE INDEX IF NOT EXISTS IDX_ACM_USER_DIRECTORY ON ACM_USER(CM_USER_DIRECTORY_NAME);

        -- First, convert the portal's directory name since that's easiest
        UPDATE ACM_USER
           SET CM_USER_DIRECTORY_NAME = 'portal'
        WHERE CM_USER_DIRECTORY_NAME = 'foiaportal';

        -- Here we check against 'portal' because the above
        -- update will have already changed the records...
        UPDATE ACM_USER
           SET CM_USER_DIRECTORY_NAME = 'arkcase'
        WHERE CM_USER_DIRECTORY_NAME != 'portal'
           AND CM_USER_DIRECTORY_NAME != ''
           AND CM_USER_DIRECTORY_NAME IS NOT NULL;

        --
        -- FIX DIRECTORY NAMES FOR GROUPS
        --

        -- Accelerate the update
        CREATE INDEX IF NOT EXISTS IDX_ACM_GROUP_DIRECTORY ON ACM_GROUP(CM_DIRECTORY_NAME);

        -- First, convert the portal's directory name since that's easiest
        UPDATE ACM_GROUP
           SET CM_DIRECTORY_NAME = 'portal'
        WHERE CM_DIRECTORY_NAME = 'foiaportal';

        -- Here we check against 'portal' because the above
        -- update will have already changed the records...
        UPDATE ACM_GROUP
           SET CM_DIRECTORY_NAME = 'arkcase'
        WHERE CM_DIRECTORY_NAME != 'portal'
           AND CM_DIRECTORY_NAME != ''
           AND CM_DIRECTORY_NAME IS NOT NULL;
