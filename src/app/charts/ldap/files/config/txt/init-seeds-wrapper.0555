#!/bin/bash

set -euo pipefail
. /.functions

set_or_default BASE_DIR "/app"
set_or_default SEED_DIR "${BASE_DIR}/seeds"

is_dir_readable "${SEED_DIR}" || fail "The seed file directory [${SEED_DIR}] was not found"
SEED_DIR="$(readlink -f "${SEED_DIR}")" || fail "Failed to resolve the real path for the seed dir (rc=${?})"

doing "Applying initialization seeds..."
while read FILE ; do
	doing "Seeding LDAP based on the data from [${FILE}]..."
	init-seeds "${FILE}" || fail "Failed to initialize the seeds from [${FILE}]"
done < <(find "${SEED_DIR}" -type f -name 'seed-*.yaml' | sort -u)
ok "Initialization seeds applied"
